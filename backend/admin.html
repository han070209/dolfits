<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>DolFits ê´€ë¦¬ì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

<script type="module" src="/admin/admin.js"></script>



<style>
#listBox {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 16px;
}
.outfit-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  background: #fff;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.outfit-card img {
  width: 100%;
  height: auto;
  display: block;
}
.outfit-meta { padding: 10px; }
</style>



<style>
.outfit-card { border:1px solid #ddd; border-radius:8px; padding:10px; margin:10px 0; }
.outfit-header { display:flex; align-items:center; justify-content:space-between; cursor:pointer; }
.thumb { width:70px; height:70px; object-fit:cover; border-radius:6px; margin-right:10px; }
.meta { flex:1; }
.outfit-body { margin-top:8px; border-top:1px dashed #ccc; padding-top:10px; }
.hidden { display:none; }
.link-table td { padding:4px; }
.add-link { margin:6px 0; }
</style>


  <style>
    body {
      font-family: system-ui, -apple-system, 'Noto Sans KR', sans-serif;
      margin: 16px;
      background: #fafafa;
    }
    h1 { margin: 0 0 12px; }
    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 16px;
      margin: 12px 0;
    }
    label { font-size: 13px; color: #333; display:block; margin-bottom:4px; font-weight:600; }
    input[type="text"], input[type="date"], input[type="file"] {
      padding:8px; border:1px solid #ccc; border-radius:8px; min-width:180px; font-family:inherit;
    }
    button {
      padding:8px 12px; border:none; border-radius:8px;
      background:#111; color:#fff; cursor:pointer; font-size:14px;
    }
    button:hover { opacity:0.9; }
    img.thumb { width:100px; height:100px; object-fit:cover; border-radius:8px; border:1px solid #eee; }
    .row { display:flex; flex-wrap:wrap; gap:8px; align-items:flex-end; }

    /* ìë™ìˆ˜ì§‘(X) ì„¹ì…˜ */
    #xList {
      display:flex; flex-wrap:wrap; gap:12px; margin-top:10px;
    }
    .x-card {
      width:180px; border:1px solid #ccc; border-radius:10px;
      padding:8px; background:#f9f9f9; text-align:center;
    }
    .x-card img {
      width:100%; height:120px; object-fit:cover; border-radius:8px; margin-bottom:6px;
    }
    .x-card small { display:block; color:#555; font-size:12px; margin-bottom:4px; }
    .x-card button { width:80px; padding:6px 0; margin:2px; font-size:12px; }
  </style>
</head>
<body>
  <h1>DolFits ê´€ë¦¬ì</h1>

  <!-- ğŸ§© ì—…ë¡œë“œ ê¸°ëŠ¥ -->
  <div class="card">
    <h3>ğŸ“¤ ìƒˆ ì°©ì¥ ì—…ë¡œë“œ</h3>
    <div class="row">
      <div>
        <label>ê·¸ë£¹ëª…</label>
        <input id="groupName" type="text" placeholder="ì˜ˆ: NewJeans" />
      </div>
      <div>
        <label>ì´ë¦„</label>
        <input id="memberName" type="text" placeholder="ì˜ˆ: í•˜ë‹ˆ" />
      </div>
      <div>
        <label>ë‚ ì§œ</label>
        <input id="uploadDate" type="date" />
      </div>
      <div>
        <label>ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
        <input id="uploadImage" type="file" accept="image/*" />
      </div>
      <div>
        <button id="uploadBtn">ì—…ë¡œë“œ</button>
      </div>
    </div>
  </div>






  <!-- ğŸ§© ì—…ë¡œë“œ ëª©ë¡ -->
  <!-- ğŸ“‚ ì—…ë¡œë“œ ëª©ë¡ -->
<div class="card">
  <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
    <h3 style="margin:0;">ğŸ“‚ ì—…ë¡œë“œ ëª©ë¡</h3>
    <div>
      <input id="searchInput" type="text" placeholder="ğŸ” ê·¸ë£¹ëª…, ì´ë¦„, ë‚ ì§œ ê²€ìƒ‰..."
        style="width:240px; padding:6px; border-radius:8px; border:1px solid #ccc;">
      <button id="searchClear" style="margin-left:6px;">âŒ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div id="listBox"></div>
</div>


<style>
  .outfit-card {
    border: 1px solid #ddd;
    border-radius: 10px;
    margin: 10px 0;
    padding: 10px;
  }
  .outfit-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
  }
  .thumb {
    width: 70px;
    height: 70px;
    object-fit: cover;
    border-radius: 8px;
    margin-right: 10px;
  }
  .meta { flex: 1; }
  .outfit-body {
    margin-top: 8px;
    padding-top: 10px;
    border-top: 1px dashed #ccc;
  }
  .hidden { display: none; }
  .link-table td { padding: 4px; }
  .add-link { margin: 8px 0; }
</style>

  </div>




  <!-- ğŸ§© ì‚¬ìš©ì ìš”ì²­ ê´€ë¦¬ -->
  <div class="card">
    <h3>ğŸ“® ì‚¬ìš©ì ìš”ì²­ ëª©ë¡</h3>
    <div id="requestList">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>

  <!-- ğŸ§© ìë™ìˆ˜ì§‘(X) ì´ë¯¸ì§€ ìŠ¹ì¸ ê´€ë¦¬ -->
  <div class="card">
    <h3>ğŸª„ ìë™ìˆ˜ì§‘(X) ì´ë¯¸ì§€ ìŠ¹ì¸ ê´€ë¦¬</h3>
    <p style="font-size:14px;color:#555;">ìˆ˜ì§‘ëœ ì´ë¯¸ì§€ë¥¼ ê²€í†  í›„ â€œìŠ¹ì¸â€ ì‹œ ìë™ìœ¼ë¡œ ì—…ë¡œë“œ ëª©ë¡ì— ë°˜ì˜ë©ë‹ˆë‹¤.</p>
    <div class="row" style="margin-bottom:8px;">
      <button id="refreshXList">ğŸ”„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
      <button id="resyncXList" style="background:#555;">ğŸ“ í´ë” ì¬ë™ê¸°í™”</button>
    </div>
    <div id="xList">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>


<div style="margin:10px 0;">

</div>





  <script>
    // âœ… ì—…ë¡œë“œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadOutfits() {
      const box = document.getElementById("listBox");
      box.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
      try {
        const res = await fetch("/outfits", { credentials: "include" });
        const data = await res.json();
        if (!data.success) throw new Error(data.error || "ë¡œë“œ ì‹¤íŒ¨");
        box.innerHTML = "";
        data.outfits.forEach(o => {
          const div = document.createElement("div");
          div.className = "row";
          div.innerHTML = `
            <img src="/uploads/${o.filename}" class="thumb">
            <div><label>ê·¸ë£¹ëª…</label><input type="text" value="${o.groupName || ""}" id="g_${o.filename}"></div>
            <div><label>ì´ë¦„</label><input type="text" value="${o.name || ""}" id="n_${o.filename}"></div>
            <div><label>ë‚ ì§œ</label><input type="date" value="${o.date || ""}" id="d_${o.filename}"></div>
            <button onclick="saveMeta('${o.filename}')">ë©”íƒ€ ì €ì¥</button>
            <button style="background:#b00" onclick="deleteOutfit('${o.filename}')">ì‚­ì œ</button>
          `;
          box.appendChild(div);
        });
      } catch (e) {
        box.textContent = "âš ï¸ ì˜¤ë¥˜: " + e.message;
      }
    }

    async function saveMeta(filename) {
      const meta = {
        groupName: document.getElementById("g_" + filename).value,
        memberName: document.getElementById("n_" + filename).value,
        date: document.getElementById("d_" + filename).value
      };
      await fetch("/update-outfit/" + filename, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        credentials: "include",
        body: JSON.stringify({ meta })
      });
      alert("âœ… ì €ì¥ ì™„ë£Œ");
    }

    async function deleteOutfit(filename) {
      if (!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
      await fetch("/delete-outfit/" + filename, { method: "DELETE", credentials: "include" });
      loadOutfits();
    }

    document.getElementById("uploadBtn").addEventListener("click", async () => {
      const file = document.getElementById("uploadImage").files[0];
      if (!file) return alert("ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”");
      const fd = new FormData();
      fd.append("image", file);
      fd.append("groupName", document.getElementById("groupName").value);
      fd.append("name", document.getElementById("memberName").value);
      fd.append("date", document.getElementById("uploadDate").value);
      const res = await fetch("/upload", { method:"POST", body:fd, credentials:"include" });
      const data = await res.json();
      if (data.success) { alert("âœ… ì—…ë¡œë“œ ì™„ë£Œ"); loadOutfits(); }
      else alert("âŒ ì‹¤íŒ¨");
    });

    // âœ… ì‚¬ìš©ì ìš”ì²­ ëª©ë¡
    async function loadRequests() {
      const box = document.getElementById("requestList");
      box.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
      try {
        const res = await fetch("/requests", { credentials:"include" });
        const data = await res.json();
        if (!data.success) throw new Error(data.error || "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
        if (!data.requests.length) { box.textContent = "ğŸ“­ ìš”ì²­ ì—†ìŒ"; return; }
        box.innerHTML = "";
        data.requests.forEach(r => {
          const div = document.createElement("div");
          div.className = "row";
          div.innerHTML = `
            <img src="/request_uploads/${r.filename}" class="thumb">
            <div style="margin-right:8px;">ID: ${r.id}</div>
            <button style="background:#b00" onclick="deleteRequest('${r.id}')">ì‚­ì œ</button>
          `;
          box.appendChild(div);
        });
      } catch(e) {
        box.textContent = "âš ï¸ ì˜¤ë¥˜: " + e.message;
      }
    }

    async function deleteRequest(id) {
      if (!confirm("ìš”ì²­ì„ ì‚­ì œí• ê¹Œìš”?")) return;
      await fetch("/delete-request/" + id, { method:"DELETE", credentials:"include" });
      loadRequests();
    }

    // âœ… ìë™ìˆ˜ì§‘(X) ëª©ë¡
    async function loadXList() {
      const box = document.getElementById("xList");
      box.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
      try {
        const res = await fetch("/auto-outfits-x", { credentials:"include" });
        const data = await res.json();
        if (!data.success) throw new Error(data.error || "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
        if (!data.list.length) { box.textContent = "ğŸ“­ ìˆ˜ì§‘ ì´ë¯¸ì§€ ì—†ìŒ"; return; }
        box.innerHTML = "";
        data.list.forEach(item => {
          const div = document.createElement("div");
          div.className = "x-card";
          div.innerHTML = `
            <img src="/auto_uploads_x/${item.filename}" alt="${item.groupName || ""}">
            <small>${item.groupName || "ê·¸ë£¹ëª… ì—†ìŒ"}</small>
            <div>
              <button class="approve">ìŠ¹ì¸</button>
              <button class="delete" style="background:#b00;">ì‚­ì œ</button>
            </div>
          `;
          div.querySelector(".approve").onclick = () => approveX(item.filename, div);
          div.querySelector(".delete").onclick = () => deleteX(item.filename, div);
          box.appendChild(div);
        });
      } catch(e) {
        box.textContent = "âš ï¸ ì˜¤ë¥˜: " + e.message;
      }
    }

    async function approveX(filename, card) {
      if (!confirm("ì´ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ ëª©ë¡ì— ìŠ¹ì¸í• ê¹Œìš”?")) return;
      card.style.opacity="0.5";
      const res = await fetch("/auto-approve-x/" + filename, { method:"POST", credentials:"include" });
      const data = await res.json();
      if (data.success) card.innerHTML = "âœ… ìŠ¹ì¸ ì™„ë£Œ!";
      else card.innerHTML = "âŒ ì‹¤íŒ¨";
    }

    async function deleteX(filename, card) {
      if (!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
      card.style.opacity="0.5";
      const res = await fetch("/auto-delete-x/" + filename, { method:"DELETE", credentials:"include" });
      const data = await res.json();
      if (data.success) card.remove(); else card.innerHTML="âŒ ì‚­ì œ ì‹¤íŒ¨";
    }

    document.getElementById("refreshXList").onclick = loadXList;
    document.getElementById("resyncXList").onclick = async () => {
      if (!confirm("í´ë”ë¥¼ ë‹¤ì‹œ ìŠ¤ìº”í•´ ëˆ„ë½ëœ íŒŒì¼ì„ JSONì— ë°˜ì˜í• ê¹Œìš”?")) return;
      const btn = document.getElementById("resyncXList");
      btn.disabled=true; btn.textContent="ğŸ“‚ ë™ê¸°í™” ì¤‘...";
      const res = await fetch("/auto-resync-x", { method:"POST", credentials:"include" });
      const data = await res.json();
      alert(data.success ? `âœ… ${data.added}ê°œ ì¶”ê°€ë¨ (${data.total}ê°œ ì´í•©)` : "âŒ ì‹¤íŒ¨");
      btn.disabled=false; btn.textContent="ğŸ“ í´ë” ì¬ë™ê¸°í™”";
      loadXList();
    };

    // âœ… í˜ì´ì§€ ë¡œë“œì‹œ
    loadOutfits();
    loadRequests();
    loadXList();
  </script>



<script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("searchInput");
  const clearBtn = document.getElementById("searchClear");
  const listBox = document.getElementById("listBox");

  if (!input || !listBox) {
    console.warn("ê²€ìƒ‰ ì…ë ¥ì°½ ë˜ëŠ” ë¦¬ìŠ¤íŠ¸ ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  console.log("âœ… ê´€ë¦¬ì ê²€ìƒ‰ ê¸°ëŠ¥ ì—°ê²°ë¨");

  input.addEventListener("input", () => {
    const term = input.value.trim().toLowerCase();
    const cards = listBox.querySelectorAll(".card, .outfit-card");
    cards.forEach((card) => {
      const text = card.textContent.toLowerCase();
      card.style.display = !term || text.includes(term) ? "" : "none";
    });
  });

  clearBtn?.addEventListener("click", () => {
    input.value = "";
    input.dispatchEvent(new Event("input"));
  });
});
</script>



</body>
</html>
