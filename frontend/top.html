<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="./menu.js" defer></script>

  <title>ì¸ê¸° ì°©ì¥ top12 | DolFits</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  

  <!-- ë¡œê³  -->
  <div class="logo">DolFits</div>

  <!-- ì œëª© -->
  <h2 class="top-title" data-i18n="top_title">ì¸ê¸° ì°©ì¥ TOP12</h2>


  <!-- ì°©ì¥ ì»¨í…Œì´ë„ˆ -->
  <div id="mainFits" class="fits-container"></div>

  <!-- ëŒê³ ë˜ ì´ë¯¸ì§€ -->
  <img src="images/dolphin.png" alt="dolphin" class="dolphin1">
  <img src="images/dolphin.png" alt="dolphin" class="dolphin2">

  <!-- ë©”ë‰´ ìŠ¤í¬ë¦½íŠ¸ -->
  

  <script>
    // âœ… ì¢‹ì•„ìš” ìƒíƒœ ê³µí†µ ê´€ë¦¬ (í™ˆê³¼ ì™„ì „íˆ ê³µìœ )
    function getLikedSet() {
      try { return new Set(JSON.parse(localStorage.getItem("df_liked_set") || "[]")); }
      catch { return new Set(); }
    }
    function saveLikedSet(set) {
      localStorage.setItem("df_liked_set", JSON.stringify([...set]));
    }

    // âœ… ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ì¢‹ì•„ìš” ìˆœ)
    async function loadTopFits() {
      const container = document.getElementById("mainFits");
      container.innerHTML = "";

      try {
        const res = await fetch(`/data/outfitss.json?t=${Date.now()}`, { cache: "no-store" });
        if (!res.ok) throw new Error("outfitss.json ë¡œë“œ ì‹¤íŒ¨");
        const json = await res.json();
        const data = Array.isArray(json) ? json : (json.outfits || []);

        // ì¢‹ì•„ìš” ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
        const sorted = data
          .filter(f => f.likes && f.likes > 0)
          .sort((a, b) => (b.likes || 0) - (a.likes || 0))
          .slice(0, 12);

        const likedSet = getLikedSet();

        sorted.forEach(f => {
          const box = document.createElement("div");
          box.className = "fit-box";

          const img = document.createElement("img");
          img.src = `/uploads/${encodeURIComponent(f.filename)}?v=${Date.now()}`;
          img.alt = f.originalname || "fit image";

          const info = document.createElement("div");
          info.className = "fit-info";

          const label = document.createElement("span");
          label.textContent = `${f.groupName || "ê·¸ë£¹ëª… ì—†ìŒ"} Â· ${f.name || "ì´ë¦„ ì—†ìŒ"}`;

          const heart = document.createElement("span");
          heart.className = "heart";
          const isLiked = likedSet.has(f.filename);
          heart.innerHTML = isLiked ? "â¤ï¸" : "â™¡";
          if (isLiked) heart.classList.add("active");

          const count = document.createElement("span");
          count.className = "like-count";
          count.textContent = f.likes > 0 ? ` ${f.likes}` : "";

          // âœ… í•˜íŠ¸ í´ë¦­ ì´ë²¤íŠ¸
          heart.addEventListener("click", async (e) => {
            e.stopPropagation();
            try {
              const nowLiked = !likedSet.has(f.filename);
              heart.innerHTML = nowLiked ? "â¤ï¸" : "â™¡";
              heart.classList.toggle("active", nowLiked);
              heart.classList.add("pop");

              if (nowLiked) likedSet.add(f.filename);
              else likedSet.delete(f.filename);
              saveLikedSet(likedSet);

              const r = await fetch(`/like/${encodeURIComponent(f.filename)}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ action: nowLiked ? "like" : "unlike" }),
              });
              const j = await r.json();
              if (j.success) count.textContent = j.likes > 0 ? ` ${j.likes}` : "";

              setTimeout(() => heart.classList.remove("pop"), 300);
            } catch (err) {
              console.error("ì¢‹ì•„ìš” ì˜¤ë¥˜:", err);
            }
          });

          // âœ… ìƒì„¸ í˜ì´ì§€ ì´ë™
          box.addEventListener("click", () => {
            window.location.href = `/detail.html?file=${encodeURIComponent(f.filename)}`;
          });

          info.appendChild(label);
          info.appendChild(heart);
          info.appendChild(count);

          box.appendChild(img);
          box.appendChild(info);
          container.appendChild(box);
        });

        if (!sorted.length) {
          container.innerHTML = `<div class="fit-info" style="position:static;color:#333;background:transparent;text-align:left;padding:0;margin-left:120px;transform:none;opacity:1">ì•„ì§ ì¢‹ì•„ìš”ê°€ ëˆ„ì ëœ ì°©ì¥ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ¥²</div>`;
        }
      } catch (err) {
        console.error("âŒ ì¸ê¸° ì°©ì¥ ë¡œë“œ ì˜¤ë¥˜:", err);
        container.innerHTML = `<div class="fit-info" style="position:static;color:#333;background:transparent;text-align:left;padding:0;margin-left:120px;transform:none;opacity:1">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤ ğŸ˜¢</div>`;
      }
    }

    // âœ… ë©”ë‰´ ì—´ê¸°/ë‹«ê¸° (í™ˆ ë™ì¼)


    // âœ… ì´ˆê¸° ë¡œë“œ
    loadTopFits();
  </script>

  <style>
    /* h2 ìœ„ì¹˜ ì¡°ì • (ë¡œê³  ì•„ë˜ ì™¼ìª½) */
    .top-title {
      position: absolute;
      top: 180px;
      left: 190px;
      font-size: 24px;
      font-weight: 700;
      color: #222;
      z-index: 2;
    }
    .fits-container { margin-top: 80px; }
  </style>
  <script src="./lang.js" defer></script>
</body>
</html>
